@inherits LayoutComponentBase

<MudThemeProvider Theme="_currentTheme" />
<MudDialogProvider />
<MudSnackbarProvider />
<Spinner />

<MudLayout Style="min-width: 350px;">
    <MudAppBar Elevation="0" Color="@(_currentTheme == lightTheme ? Color.Primary : Color.Inherit)" Style="min-width: 350px;">

        @if (_drawerOpen == false)
        {
            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="() => _drawerOpen = !_drawerOpen" />
            <MudText Typo="Typo.h6" Style="white-space: nowrap">Dating App</MudText>
        }

        <AuthorizeView Context="AppBarContext">
            <Authorized>

                <MudBreakpointProvider>
                    <MudHidden Breakpoint="Breakpoint.SmAndUp" Invert="true">

                        <MudContainer Class="d-flex" MaxWidth="MaxWidth.ExtraSmall">
                            <MudNavLink Href="/members" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.People" Style="width: unset;">
                                <MudText Typo="Typo.body1">Members</MudText>
                            </MudNavLink>

                            <MudNavLink Class="mx-auto" Href="/lists" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.List" Style="width: unset;">
                                <MudText Typo="Typo.body1">Lists</MudText>
                            </MudNavLink>

                            <MudNavLink Href="/messages" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Message" Style="width: unset;">
                                <MudText Typo="Typo.body1">Messages</MudText>
                            </MudNavLink>
                        </MudContainer>

                    </MudHidden>
                </MudBreakpointProvider>

                <MudSpacer />

                @if (AppUserService.AppUser is not null)
                {
                    <MudMenu AnchorOrigin="Origin.BottomLeft">
                        <ActivatorContent>
                            <MudAvatar Image="@AppUserService.MainPhoto" />
                        </ActivatorContent>
                        <ChildContent>
                            <MudMenuItem Class="px-0 py-0">
                                <MudNavLink Href="/member/edit" Match="NavLinkMatch.All" Style="white-space: nowrap">
                                    <strong>Edit Profile</strong>
                                </MudNavLink>
                            </MudMenuItem>
                            <MudDivider />
                            <MudMenuItem Class="px-0 py-0">
                                <MudNavLink @onclick="() => HandleLogoutAsync()">
                                    <strong>Logout</strong>
                                </MudNavLink>
                            </MudMenuItem>
                        </ChildContent>
                    </MudMenu>
                }
            </Authorized>
            <NotAuthorized>

                <MudSpacer />

                <MudBreakpointProvider>
                    <MudHidden Breakpoint="Breakpoint.MdAndUp" Invert="true">
                        <EditForm class="d-flex align-center" Model="@_loginUser" OnValidSubmit="HandleLoginAsync">
                            <MudTextField Class="d-inline-flex mx-2"
                                          Variant="Variant.Outlined"
                                          Margin="Margin.Dense"
                                          Label="Username"
                                          @bind-Value="_loginUser.Username"
                                          Adornment="Adornment.End"
                                          AdornmentIcon="@Icons.Filled.Person"
                                          AdornmentAriaLabel="Username"
                                          Style=@(_currentTheme == lightTheme ? "color: #495057; background: #fff; border-radius: .25rem;" : "") />
                            <MudTextField Class="d-inline-flex mx-2"
                                          Variant="Variant.Outlined"
                                          Margin="Margin.Dense" Label="Password"
                                          InputType="@_passwordInput"
                                          @bind-Value="_loginUser.Password"
                                          Adornment="Adornment.End"
                                          AdornmentIcon="@_passwordInputIcon"
                                          OnAdornmentClick="ToggleShowPassword"
                                          AdornmentAriaLabel="Show Password"
                                          Style=@(_currentTheme == lightTheme ? "color: #495057; background: #fff; border-radius: .25rem;" : "") />
                            <MudButton Class="d-inline-flex mx-2"
                                       Variant="Variant.Filled"
                                       Color="Color.Success"
                                       ButtonType="ButtonType.Submit"
                                       Size="Size.Medium"
                                       StartIcon="@Icons.Filled.Login">
                                Login
                            </MudButton>
                        </EditForm>
                    </MudHidden>
                </MudBreakpointProvider>

            </NotAuthorized>
        </AuthorizeView>

        @if (_currentTheme == lightTheme)
        {
            <MudButton OnClick="@((e) => ToggleThemeAsync())">
                <MudIcon Icon="@Icons.Material.Filled.DarkMode" Color="Color.Default"></MudIcon>
            </MudButton>
        }
        else
        {
            <MudButton OnClick="@((e) => ToggleThemeAsync())">
                <MudIcon Icon="@Icons.Material.Filled.LightMode"></MudIcon>
            </MudButton>
        }
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Elevation="1" Color="@(_currentTheme == lightTheme ? Color.Primary : Color.Dark)">
        <MudDrawerHeader Class="d-flex align-center">
            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="() => _drawerOpen = !_drawerOpen" />
            <MudText Typo="Typo.h6" Style="white-space: nowrap">Dating App</MudText>
        </MudDrawerHeader>
        <MudDrawerContainer>
            <AuthorizeView Context="DrawerContext">
                <Authorized>
                    <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">
                        <MudText Typo="Typo.body1">Home</MudText>
                    </MudNavLink>

                    <MudNavLink Href="/members" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.People">
                        <MudText Typo="Typo.body1">Members</MudText>
                    </MudNavLink>

                    <MudNavLink Href="/lists" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.List">
                        <MudText Typo="Typo.body1">Lists</MudText>
                    </MudNavLink>

                    <MudNavLink Href="/messages" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Message">
                        <MudText Typo="Typo.body1">Messages</MudText>
                    </MudNavLink>
                </Authorized>
                <NotAuthorized>
                    <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">
                        <MudText Typo="Typo.body1">Home</MudText>
                    </MudNavLink>

                    <MudNavLink Href="/register" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.EditNote">
                        <MudText Typo="Typo.body1">Register</MudText>
                    </MudNavLink>

                    <MudNavLink Href="/login" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Login">
                        <MudText Typo="Typo.body1">Login</MudText>
                    </MudNavLink>

                </NotAuthorized>
            </AuthorizeView>
        </MudDrawerContainer>
    </MudDrawer>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pt-16">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>
