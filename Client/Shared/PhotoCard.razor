@inject IMemberService MemberService
@inject IToastService ToastService

<div class="col-12 col-sm-6 col-lg-4 col-xl-3">
    <img class="img-thumbnail rounded p-1" src="@ResultFilename">
    <div class="text-center">
        <button class="btn">Main</button>
        <button class="btn btn-danger" @onclick="HandleDelete"><i class="fa fa-trash" /></button>
    </div>
</div>

@code {
    [Parameter]
    public string Username { get; set; }
    
    [Parameter]
    public PhotoModel Photo { get; set; }

    [Parameter]
    public EventCallback<string> OnImageChanged { get; set; }

    private string ResultFilename { get; set; } = "./assets/user.png";

    protected override async Task OnParametersSetAsync()
    {
        ResultFilename = await MemberService.GetPhotoAsync(Username, Photo.Filename);
    }

    private async Task HandleDelete()
    {
        ServiceResponseModel<string> result = await MemberService.DeletePhotoAsync(Username, Photo);

        if (result.Success)
        {
            ToastService.ShowSuccess("Photo deleted successfully");
            await OnImageChanged.InvokeAsync();
        }
        else
        {
            ToastService.ShowError($"{result.Message}");
        }
    }
}
