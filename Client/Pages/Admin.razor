@page "/Admin"
@attribute [Authorize(Roles = "Administrator,Moderator")]

<PageTitle>DatingApp - Admin Panel</PageTitle>

<section>
    <MudText Typo="Typo.h2" Align="Align.Center" Class="mb-5">Admin Panel</MudText>

    @if (_showError)
    {
        <MudAlert Severity="Severity.Error">@_errorText</MudAlert>
    }

    <MudTabs Elevation="6" Centered="true" Rounded="true" Color="Color.Primary">

        <AuthorizeView Roles="Administrator" Context="UserManagement">
            <Authorized>
                <MudTabPanel Text="User management">
                    <MudContainer Class="mt-5 px-0">
                        @if (_users?.Count > 0)
                        {
                            <MudGrid Class="mb-2" Justify="Justify.Center">
                                <MudItem xs="12" xl="8">
                                    <MudTable T="UserWithRolesModel"
                                          Items="@_users"
                                          Dense="true"
                                          Hover="true"
                                          Bordered="true"
                                          Striped="true"
                                          Loading="@_loadingUsers"
                                          LoadingProgressColor="Color.Info"
                                          Breakpoint="Breakpoint.None"
                                          HorizontalScrollbar="true"
                                          Elevation="20">
                                        <HeaderContent>
                                            <MudTh><MudText Typo="Typo.h5">Username</MudText></MudTh>
                                            <MudTh><MudText Typo="Typo.h5">Roles</MudText></MudTh>
                                            <MudTh><MudText Typo="Typo.h5">Actions</MudText></MudTh>
                                        </HeaderContent>
                                        <RowTemplate>
                                            <MudTd><MudText Typo="Typo.h6">@context.Username</MudText></MudTd>
                                            <MudTd><MudText Typo="Typo.h6">@(string.Join(", ", context.Roles))</MudText></MudTd>
                                                <MudTd><MudButton Variant="Variant.Filled" Color="Color.Info">Edit Roles</MudButton></MudTd>
                                            </RowTemplate>
                                        </MudTable>
                                    </MudItem>
                                </MudGrid>

                            <MudPagination Class="d-flex justify-center my-5"
                                       Rectangular="true"
                                       Color="Color.Primary"
                                       Count="@_metaData.TotalPages"
                                       Size="Size.Large"
                                       Selected="@_metaData.CurrentPage"
                                       SelectedChanged="HandlePageChangedAsync" />
                        }
                    </MudContainer>
                </MudTabPanel>
            </Authorized>
        </AuthorizeView>

        <AuthorizeView Roles="Administrator,Moderator" Context="PhotoModeration">
            <Authorized>
                <MudTabPanel Text="Photo management">
                    <MudContainer Class="mt-5 px-0">
                        Photo-management works!
                    </MudContainer>
                </MudTabPanel>
            </Authorized>
        </AuthorizeView>

    </MudTabs>

</section>
